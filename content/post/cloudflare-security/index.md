---
title: Intro to Cloudflare
date: 2021-04-18T10:22:53.306Z
draft: false
featured: true
tags:
  - Security
  - Web Development
  - Cloudflare
  - CyberSec
categories:
  - Security
image:
  filename: featured.png
  focal_point: Smart
  preview_only: true
toc: true
---

Welcome to a brief introduction to Cloudflare.

{{% toc %}}

* * *

## Cloudflare Overview

Cloudflare is an integrated and intelligent Global Cloud (Anycast) Network.

Mission: to help build a better Internet.

### Cloudflare in Numbers

![An Integrated Global Cloud Network](/media/Cloudflare/cloudflare-at-a-glance-v1.webp)
_<caption>Image source: made by [Lunalabs](https://www.lunalabs.eu/) with info updated on the 20th of February.</caption>_

-   51Tb+ of global network capacity.
-   Accessible via 200 Points of Presence (POPs), strategically situated across 100 countries.
-   Handles 18M+ web requests per second on average.
-   Serves 25M+ protected web sites and services.
-   Blocks an average of 72B cyber threats a day.

### Why choose Cloudflare

![Why customers choose Cloudflare](/media/Cloudflare/why-cloudflare.webp)

-   Shared Intelligence
-   Network Scale
-   Ease of Use
-   No Trade Offs (Security + Performance)

* * *

## Cloudflare's Solutions

See below a brief overview on Cloudflare's integrated global cloud network.

![An Integrated Global Cloud Network](/media/Cloudflare/cloudflare-global-cloud-network.webp)
_<caption>Image source: <https://www.cloudflare.com/enterprise/></caption>_

Here is a preview of how the Cloudflare Dashboard looks like once you added your domain.

![Cloudflare Web Dashboard](/media/Cloudflare/cloudflare-dashboard.webp)
_<caption>Image source: <https://dash.cloudflare.com/></caption>_

Below you'll find some of the most important solutions that Cloudflare offers.
They are divided up the following categories:

-   Security üîê
-   Performance ‚ö°
-   Reliability üìà
-   Connectivity üîå
-   Edge Developer Platform (Serverless) ‚òÅÔ∏è
-   Analytics & Insights üìä
-   Enterprise Security üîë
-   Privacy üîè

### <b>Security</b>

-   #### [Web Application Firewall (WAF)](https://www.cloudflare.com/waf/)

-   #### [DDoS Protection](https://www.cloudflare.com/ddos/)

-   #### [Bot Management](https://www.cloudflare.com/products/bot-management/)

-   #### [Rate Limiting](https://www.cloudflare.com/rate-limiting/)

-   #### [SSL / TLS](https://www.cloudflare.com/ssl/)

-   #### [SSL for SaaS](https://www.cloudflare.com/ssl-for-saas-providers/)

-   #### [Spectrum](https://www.cloudflare.com/products/cloudflare-spectrum/)

-   #### [Cloudflare for Campaigns](https://www.cloudflare.com/campaigns/)

-   #### [DNSSEC](hhttps://www.cloudflare.com/dns/dnssec/)

-   #### [Orbit IoT protection](https://www.cloudflare.com/orbit/)

### <b>Performance</b>

-   #### [Content Delivery Network (CDN)](https://www.cloudflare.com/cdn/)

-   #### [Website Optimization](https://www.cloudflare.com/website-optimization/)

-   #### [Stream](https://www.cloudflare.com/products/cloudflare-stream/)

-   #### [Stream Delivery](https://www.cloudflare.com/products/stream-delivery)

-   #### [Waiting Room](https://www.cloudflare.com/waiting-room/)

### <b>Reliability</b>

-   #### [Argo Smart Routing](https://www.cloudflare.com/products/argo-smart-routing/)

-   #### [Load Balancing](https://www.cloudflare.com/load-balancing/)

-   #### [Managed DNS](https://www.cloudflare.com/dns/)

### <b>Connectivity</b>

-   #### [Argo Tunnel](https://www.cloudflare.com/products/argo-tunnel/)

-   #### [Private Network Interface (PNI)](https://www.cloudflare.com/partners/peering-portal/)

-   #### [Magic Transit](https://www.cloudflare.com/magic-transit/)

### <b>Edge Developer Platform (Serverless)</b>

-   #### [Workers](https://workers.cloudflare.com/)

-   #### [Workers KV](https://www.cloudflare.com/products/workers-kv/)

-   #### [Workers Unbound](https://www.cloudflare.com/workers-unbound-beta/)

### <b>Analytics & Insights</b>

-   #### [Analytics](https://www.cloudflare.com/analytics/)

-   #### [Cloudflare Logs](https://www.cloudflare.com/products/cloudflare-logs/)

-   #### [Web Analytics](https://www.cloudflare.com/web-analytics/)

-   #### [Cloudflare Radar](https://radar.cloudflare.com/)

-   #### [Cloudflare Speed](https://speed.cloudflare.com/)

### <b>Enterprise Security</b>

-   #### [Cloudflare Gateway](https://www.cloudflare.com/teams/gateway/)

-   #### [Cloudflare Access](https://www.cloudflare.com/teams/access/)

-   #### [Browser Isolation](https://www.cloudflare.com/teams/browser-isolation/)

-   #### [Cloudflare Network Interconnect (CNI)](https://www.cloudflare.com/network-interconnect/)

-   #### [Magic WAN](https://www.cloudflare.com/magic-wan/)

-   #### [China Network](https://www.cloudflare.com/china-network/)

### <b>Privacy</b>

-   #### [Data Localization](https://www.cloudflare.com/data-localization/)

-   #### [Compliance](https://www.cloudflare.com/privacy-and-compliance/)


As honorable mentions: [Cloudflare Pages](https://pages.cloudflare.com/) and [Cloudflare Registrar](https://www.cloudflare.com/products/registrar/) are definitely worth checking out, if you are interested in building your own website. Easy to use, and immediate security, reliability, and performance for your website.

* * *

## More Materials

Here a list of interesting links on Cloudflare.com:

-   [Blog](https://blog.cloudflare.com/)
-   [Support](https://support.cloudflare.com/)
-   [Learning](https://www.cloudflare.com/learning/)
-   [Community](https://community.cloudflare.com/)
-   [Developers ‚Äì¬†Your imagination, Cloudflare's infrastructure](https://developers.cloudflare.com/)
-   [System Status](https://www.cloudflarestatus.com/)
-   [Pricing](https://www.cloudflare.com/plans/)

Learn more about Cloudflare and its solutions here:

-   [Flare Ups ‚Äì HHHYPERGROWTH](https://hhhypergrowth.com/flare-ups/)
-   [2 Pager ‚Äì Cloudflare](https://cloudflare.showpad.com/share/6mnHykeSSFAUupFxQxcC3)
-   [Cloudflare YouTube Channel](https://www.youtube.com/c/cloudflare/about)
-   [Cloudflare on the Edge ‚Äì Stratechery](https://stratechery.com/2021/cloudflare-on-the-edge/)

If you are interested in learning more about **performance browser networking**, check out these links:

-   [High Performance Browser Networking](https://hpbn.co/)

* * *

## Disclaimer

This is a very general introduction to Cloudflare. Educational purposes only, and this blog post does not necessarily reflect the opinions of Cloudflare. There are many more aspects to Cloudflare and its products and services¬†‚Äì this is merely a brief educational intro. Properly inform yourself, keep learning, keep testing, and feel free to share your learnings and experiences as I do. Hope it was helpful! Images are online and publicly accessible.

* * *

## My Personal Website

After joining Cloudflare, I recognized the amazing potential of Cloudflare Pages and all of its other products, so I decided to migrate my website from Netlify to Cloudflare (sorry Netlify¬†‚Äì it was nice!).

### Step 0: Cloudflare Pages

First, I created a FREE account on Cloudflare, and connected my GitHub repository with Cloudflare Pages.

I had to tweak the deployment a little by adding the build command:
```
hugo --gc --minify -b https://CLOUDFLARE-PAGES.pages.dev/
```

Additionally, I had to set an Environment Variable:
```
HUGO_VERSION   0.80.0
```

After that, the page deployed and worked just fine.

### Step 1: DNS

Now, go to dash.cloudflare.com and add your custom domain. Choose the FREE plan for starters, and simply follow the next steps.

On the DNS tab, add the following DNS records in order to connect to the page on Cloudflare Pages:
```
CNAME   davidtofan.com    CLOUDFLARE-PAGES.pages.dev   Auto
CNAME   www               CLOUDFLARE-PAGES.pages.dev   Auto
```

Furthermore, I also added an empty MX record because I do not use this domain for emails nor do I want to receive emails:
```
MX      davidtofan.com    .                            Auto
```

### Step 2: Domain

In order to redirect www to davidtofan.com, go to Page Rules > Forwarding URL and set up the following Permanent Redirect Rule 301:

Matching URL:
```
www.davidtofan.com/*
```

Destination URL:
```
https://davidtofan.com/$1
```

_Note: the DNS records need to be configured properly for this to work._

Then, I activated the DNSSEC function to add an extra layer of protection to my domain.

### Step 3: Workers

Now on to Workers ‚Äì it's simply amazing! You can deploy serverless code instantly across the globe.

I used this JavaScript template to create HTTP Security Headers for my website by using Workers:
```
let securityHeaders = {
    "Content-Security-Policy": "default-src 'self'; upgrade-insecure-requests; script-src 'self' https://static.cloudflareinsights.com; img-src 'self'; object-src 'none'; form-action 'none'; base-uri 'self'; worker-src 'none'; connect-src 'self' https://static.cloudflareinsights.com/ https://cloudflareinsights.com/; child-src 'none'; frame-src 'none'; frame-ancestors 'none';",
    "Strict-Transport-Security": "max-age=63072000; includeSubDomains; preload",
    "X-XSS-Protection": "1; mode=block",
    "X-Frame-Options": "DENY",
    "X-Content-Type-Options": "nosniff",
    "Referrer-Policy": "no-referrer",
    "Permissions-Policy": "fullscreen=(self), autoplay=(), geolocation=(), microphone=(), camera=(), payment=(), interest-cohort=()",
    "Access-Control-Allow-Origin": "https://cloudflareinsights.com/"
}
let sanitiseHeaders = {
    Server: "My new server header"
}
let removeHeaders = [
    "Public-Key-Pins",
    "X-Powered-By",
    "X-AspNet-Version"
]

addEventListener('fetch', event => {
	event.respondWith(addHeaders(event.request))
})

async function addHeaders(req) {
	let response = await fetch(req)
	let newHdrs = new Headers(response.headers)

	if (newHdrs.has("Content-Type") && !newHdrs.get("Content-Type").includes("text/html")) {
        return new Response(response.body , {
            status: response.status,
            statusText: response.statusText,
            headers: newHdrs
        })
	}

	Object.keys(securityHeaders).map(function(name, index) {
		newHdrs.set(name, securityHeaders[name]);
	})

	Object.keys(sanitiseHeaders).map(function(name, index) {
		newHdrs.set(name, sanitiseHeaders[name]);
	})

	removeHeaders.forEach(function(name){
		newHdrs.delete(name)
	})

	return new Response(response.body , {
		status: response.status,
		statusText: response.statusText,
		headers: newHdrs
	})
}
```

Don't forget to add ```https://static.cloudflareinsights.com``` to your ```script-src``` directive and ```https://cloudflareinsights.com``` to your ```connect-src``` directive, in order to make [Web Analytics](https://www.cloudflare.com/web-analytics/) work on Cloudflare.

Feel free to change any details and adapt it to your needs. If you need help with the Content Security Policy (CSP), then check out my other [article](/post/website-security/).

_Code source: [The brand new Security Headers Cloudflare Worker](https://scotthelme.co.uk/security-headers-cloudflare-worker/)_

### Step 4: Firewall

Now we set up a Firewall Rule on the Firewall Tab > Firewall Rules, such as for example to block some python requests on my website:
```
(http.user_agent contains "python")
```

There are some interesting examples on [Runcloud Blog](https://blog.runcloud.io/cloudflare-firewall-rules/).

### Step 5: Results

Finally, we analyze our website and check what has changed or improved:

-   [Cloudflare Diagnostic Center](https://www.cloudflare.com/diagnostic-center/?url=davidtofan.com)
-   [Security Headers](https://securityheaders.com/?q=https%3A%2F%2Fdavidtofan.com%2F&hide=on&followRedirects=on)
-   [Google PageSpeed Insights](https://developers.google.com/speed/pagespeed/insights/?url=https%3A%2F%2Fdavidtofan.com%2F)
-   [Google Mobile-Friendly Test](https://search.google.com/test/mobile-friendly?id=BucltckOIIJdgi9CnUc4Uw)
-   [Web Page Test](https://www.webpagetest.org/)
-   [DNSViz DNSSEC](https://dnsviz.net/d/davidtofan.com/dnssec/)
-   [DNSSEC Analyzer](https://dnssec-analyzer.verisignlabs.com/davidtofan.com)

## Conclusion

Coming soon! Still working on some stuff...
